# Exploitation

## Exploitation

The program that we'll be exploiting:

```c
#include <stdio.h>
#include <stdlib.h>

void win() {
    system("/bin/sh");
}

int main() {
    char buf[64];
    puts("What are you going to say?");
    gets(buf);
    puts("Thank you, have a nice day!");
    return 0;
}
```

And has been compiled as so

```c
$ gcc -fno-stack-protector -no-pie -z execstack -o vuln vuln.c -Wall
```

When we perform binary exploitation, we have our main aim: 1. Remote Code Execution \(RCE\)

* We can execute any code we want on the target machine

In CTFs, this is shown either by

* Gaining a bash shell
* Reading a `flag.txt` file

One way which we can gain RCE \(for Linux\) is by executing the command `system("/bin/sh")` which will execute the system command with parameters `/bin/sh`, which will start a shell for us!

As you can see, we have the `system("/bn/sh")` call in the file already, great! So our aim is to get that to execute.

### Analysis

So we've already got the source, so let's analyse it. We could use a tool called `Ghidra` or `Ida`, but I don't want to scare you just yet :\)

So in our `main` function, we have a variable named `buf` which can hold 64 characters. A message is then printed, and then our input is entered and stored into `buf` with the `gets` call. Another message is sent, and then the program returns `0` and exits.

Now, when you compile, you're going to get a warning

```c
vuln.c: In function ‘main’:
vuln.c:11:2: warning: implicit declaration of function ‘gets’; did you mean ‘fgets’? [-Wimplicit-function-declaration]
   11 |  gets(buf);
      |  ^~~~
      |  fgets
/usr/bin/ld: /tmp/cc00OxSA.o: in function `main':
vuln.c:(.text+0x34): warning: the `gets' function is dangerous and should not be used.
```

What's wrong with `gets`? Let's take a look at the man page

